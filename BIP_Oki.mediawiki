<pre>
  BIP: BBB 'Bigger Bitcoin Blocks'
  Layer: Consensus (hard fork)
  Title: Dynamic maximum block weight by miner vote
  Author: Oki Burokku <oki_burokku@protonmail.com>
  Comments-Summary: No comments yet.
  Comments-URI: https://github.com/oki-burokku/bitcoin/The-White-Paper/
  Status: Requires Miner Consensus.
  Type: Standards Track
  Created: 2020-06-01
  License: BSD-2-Clause
</pre>

==Abstract==

Replace the static base block weight hard limit with a hard limit set by coinbase vote, conducted on the same schedule as difficulty retargeting.

==Motivation==

Miners directly feel the effects, both positive and negative, of any maximum block weight change imposed by their peers.  Larger blocks allow more growth in the on-chain ecosystem, while smaller blocks reduce resource requirements network-wide.  Miners also act as an efficient proxy for the rest of the ecosystem, since they are paid in the tokens collected for the blocks they create.

A simple deterministic system is specified, whereby a 75% mining supermajority may activate a change to the maximum block weight each 2016 blocks.  Each change is limited to a 4M increase from the previous block weight hard limit, or a decrease of similar magnitude.  Among adopting nodes, there will be no disagreement on the evolution of the maximum block weight.

==Specification==

===Dynamic Maximum Block Weight===
# Initial value of <code>hardLimit</code> is 4M.
# The <code>hardLimit</code> shall only be increased or decreased by 4M.
# The minimum <code>hardLimit</code> shall be 4M.
# Changing <code>hardLimit</code> is accomplished by encoding a multiplier of 4M, a vote, within a block's coinbase scriptSig, and by processing the votes contained in the previous retargeting period.<br /><br />
## Vote encoding
### A vote is represented as a multipler of 4M using the BIPBBB pattern<br /><br /><code>/BIPBBB/M[0-9]+/</code><br /><br />Example 1: <code>/BIPBBB/M2/</code> is a vote for a 8000000-byte <code>hardLimit</code>.<br /><br />Example 2: <code>/BIPBBB/M11/</code> is a vote for a 44000000-byte <code>hardLimit</code>.<br /><br />
### If the block height is encoded at the start of the coinbase scriptSig, as per BIP34, it is ignored.
### Only the first BIPBBB pattern match is processed in "Maximum block weight recalculation" below.
### A multiplier value is represented by consecutive base-ten digits.
## Maximum block weight recalculation
### A <code>new hardLimit</code> is calculated after each difficulty adjustment period of 2016 blocks, and applies to the next 2016 blocks.
### Absent/zero-valued votes are counted as votes for the <code>current hardLimit</code>, which is defined as the <code>hardLimit</code> of the last block in the previous interval.
### The votes of the previous 2016 blocks are sorted by multiplier vote.
### Raising <code>hardLimit</code><br /><br />
#### The <code>new multiplier</code> is defined as the vote of the 1512th highest block.
#### If the resultant <code>new multiplier</code> is greater than <code>current mulitpiler</code>, it is set to (<code>current mulitpiler</code> + 1).
#### If the resultant <code>raise value</code> is greater than <code>current hardLimit</code>, the <code>raise value</code> becomes the <code>new hardLimit</code> and the recalculation is complete.<br /><br />
### Lowering <code>hardLimit</code><br /><br />
#### The <code>lower value</code> is defined as the vote of the 1512th lowest block, converted to bytes.
#### If the resultant <code>lower value</code> is less than (<code>current hardLimit</code> / 1.05) rounded down, it is set to that value.
#### If the resultant <code>lower value</code> is less than <code>current hardLimit</code>, the <code>lower value</code> becomes the <code>new hardLimit</code> and the recalculation is complete.<br /><br />
### Otherwise, <code>new hardLimit</code> remains the same as <code>current hardLimit</code>.

===Signature Hashing Operations Limits===
# The per-block signature hashing operations limit is scaled to (actual block size, fractional megabyte rounded to next higher megabyte) / 50.
# A maximum serialized transaction size of 1000000 bytes is imposed.

==Recommendations==

===Publication of <code>hardLimit</code>===
# For the benefit of all observers, it is recommended that <code>hardLimit</code> be published.  Example: a complete coinbase string might read <br /><br /><code>/BIPBBB/B8/EB2.123456/</code><br /><br /> which indicates a vote for 8M maximum block size, and an enforced <code>hardLimit</code> of 2.123456 megabytes for the block containing the coinbase string.

==Deployment==

This BIP is presumed deployed and activated as of a past block height by implementing nodes on the bitcoin mainnet.  The activation height is implementation parameter 2 (IP2).  It has no effect until a raise value different from IP1 is observed, which requires at least 1512 of 2016 blocks to vote differently from IP1.

==Backward compatibility==

The first block larger than IP1 will create a network partition, as nodes with a fixed IP1 hard limit reject that block.

==Implementations==
https://github.com/bitcoinxt/bitcoinxt/pull/188</br>
https://github.com/bitcoinxt/bitcoin/pull/1</br>
https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/398</br>

==Copyright==
This document is based on the original BIP100 proposal by J. Garzik, T. Harding & D. Johannsson.
This document is licensed under the BSD 2-clause license.

